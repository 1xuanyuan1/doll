var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Actions;!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.UP=2]="UP",t[t.DOWN=3]="DOWN"}(Actions||(Actions={}));var Main=function(t){function e(){var e=t.call(this)||this;return e._position=0,e._positionY=0,e._step=10,e._isRunning=!1,e._isStarting=!1,e._probability=.5,e._toys=[],e._masks=[],console.log(window.location),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.checkCollision=function(t,e){this._dot.x=t,this._dot.y=e},e.prototype.directionClick=function(t,e){var i=this;if(this._isStarting){if(this._up.hitTestPoint(t,e,!0))return void this.move(Actions.UP);if(this._down.hitTestPoint(t,e,!0))return void this.move(Actions.DOWN);if(this._left.hitTestPoint(t,e,!0))return void this.move(Actions.LEFT);if(this._right.hitTestPoint(t,e,!0))return void this.move(Actions.RIGHT);if(this._btn.hitTestPoint(t,e,!0)){if(this._isRunning)return;this._isRunning=!0;var s=this._zhuaMask.y-this._zhua.y-this._zhua.height-50;return console.log("moveHight: "+s),egret.Tween.get(this._line).to({height:this._line.height+s},500,egret.Ease.sineIn).wait(100).to({height:this._line.height},500,egret.Ease.sineOut).wait(100),void egret.Tween.get(this._zhua).to({y:this._zhua.y+s},500,egret.Ease.sineIn).wait(100).call(function(){i._zhua.texture=RES.getRes("zhua2_png"),i._zhua.x+=38,i._zhua.width=107;var t=i._zhua.x+i._zhua.width/2,e=i._zhua.y+i._zhua.height,h=function(h){var n=i._toys[h];return n.hitTestPoint(t,e,!0)?(egret.Tween.get(n).to({y:n.y-s},500,egret.Ease.sineOut).wait(100).call(function(){var t=Math.random()>i._probability;if(t){var e=i._masks[h];i.removeChild(e),i._masks.splice(parseInt(h),1),i._masks.length>0?(i._selectMask.x=i._masks[0].x,i._selectMask.y=i._masks[0].y):i.removeChild(i._selectMask),egret.Tween.get(n).to({x:n.x-i._position},300,egret.Ease.sineIn).wait(100).to({y:n.y+s-i._positionY},300,egret.Ease.sineIn).call(function(){i.removeChild(n),i._toys.splice(parseInt(h),1),0===i._toys.length&&setTimeout(function(){i._isStarting=!1,i.toggleShow(i._isStarting)})})}else{var a=function(){n.rotation=20*Math.random()-10};egret.Tween.get(n,{onChange:a,onChangeObj:i}).to({y:n.y+s},300,egret.Ease.sineIn)}}),{value:void 0}):void 0};for(var n in i._toys){var a=h(n);if("object"==typeof a)return a.value}}).to({y:this._zhua.y},500,egret.Ease.sineOut).wait(100).call(function(){i._isRunning=!1,i.back()})}}else this._start.hitTestPoint(t,e,!0)&&(this._isStarting=!0,this.toggleShow(this._isStarting),this.initToy())},e.prototype.toggleShow=function(t){this._up.$setVisible(t),this._down.$setVisible(t),this._left.$setVisible(t),this._right.$setVisible(t),this._btn.$setVisible(t),this._start.$setVisible(!t)},e.prototype.move=function(t){var e=this;if(t===Actions.RIGHT||t===Actions.LEFT){if(t===Actions.LEFT&&this._position<1||t===Actions.RIGHT&&this._position>510)return;var i=t===Actions.RIGHT?this._step:-1*this._step;this._position+=i,egret.Tween.get(this._top).to({x:this._top.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._line).to({x:this._line.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhuaShade).to({x:this._zhuaShade.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhuaMask).to({x:this._zhuaMask.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhua).to({x:this._zhua.x+i},100,egret.Ease.sineIn).call(function(){e.moveEnd(t)})}else{var i=t===Actions.UP?-1*this._step:this._step;this._positionY+=i,egret.Tween.get(this._zhuaShade).to({y:this._zhuaShade.y+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhuaMask).to({y:this._zhuaMask.y+i},100,egret.Ease.sineIn).call(function(){e.moveEnd(t)})}},e.prototype.moveEnd=function(t){var e=this;this._dot.parent&&setTimeout(function(){e.move(t)},30);for(var i=0,s=this._masks;i<s.length;i++){var h=s[i],n=h.x+h.width/2,a=h.y+h.height/2;if(this._zhuaMask.hitTestPoint(n,a,!0)){if(this._selectMask.x=h.x,this._selectMask.y=h.y,this.getChildIndex(this._zhuaShade)-this.getChildIndex(h)!==1){var o=this.getChildIndex(h);this.setChildIndex(this._zhuaShade,o),this.setChildIndex(this._zhua,o),this.setChildIndex(this._line,o)}return}}},e.prototype.back=function(){var t=this;egret.Tween.get(this._top).to({x:this._top.x-this._position},300,egret.Ease.sineIn),egret.Tween.get(this._line).to({x:this._line.x-this._position},300,egret.Ease.sineIn),egret.Tween.get(this._zhuaMask).to({x:this._zhuaMask.x-this._position,y:this._zhuaMask.y-this._positionY},300,egret.Ease.sineIn),egret.Tween.get(this._zhuaShade).to({x:this._zhuaShade.x-this._position,y:this._zhuaMask.y-this._positionY},300,egret.Ease.sineIn),egret.Tween.get(this._zhua).to({x:this._zhua.x-this._position},300,egret.Ease.sineIn).call(function(){t._position=0,t._positionY=0,t._zhua.texture=RES.getRes("zhua1_png"),t._zhua.x-=38,t._zhua.width=183})},e.prototype.initToy=function(){for(var t=0;3>t;t++)for(var e=0;3>e;e++){var i=this.createBitmapByName("cartoon-egret_00_png");i.width=114,i.height=190,i.x=460-120*e-t%2*80,i.y=570-100*t,i.rotation=20*Math.random()-10,i.name="toy_"+(e+1)+"_"+(t+1),this.addChild(i),this.setChildIndex(i,6),this._toys.push(i);var s=new egret.Shape;s.graphics.lineStyle(0),s.graphics.beginFill(0),s.graphics.drawEllipse(0,0,114,50),s.graphics.endFill(),s.x=460-120*e-t%2*80,s.y=730-100*t,s.name="mask_"+(e+1)+"_"+(t+1),this.addChild(s),this.setChildIndex(s,6),this._masks.push(s)}this._selectMask=new egret.Shape,this._selectMask.name="_selectMask",this._selectMask.graphics.lineStyle(0),this._selectMask.graphics.beginFill(0),this._selectMask.graphics.drawEllipse(0,0,114,50),this._selectMask.graphics.endFill(),this._selectMask.x=460,this._selectMask.y=730,this.addChild(this._selectMask),this.setChildIndex(this._selectMask,6),this._zhuaShade.$setVisible(!0),this._zhuaMask.$setVisible(!0),this._zhuaShade.$mask=this._selectMask},e.prototype.touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_MOVE:this.checkCollision(t.stageX,t.stageY);break;case egret.TouchEvent.TOUCH_BEGIN:this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.stage.once(egret.TouchEvent.TOUCH_END,this.touchHandler,this),this.addChild(this._dot),this.checkCollision(t.stageX,t.stageY),this.directionClick(t.stageX,t.stageY);break;case egret.TouchEvent.TOUCH_END:this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandler,this),this._dot.parent&&this._dot.parent.removeChild(this._dot)}},e.prototype.createGameScene=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandler,this);var t=this.createBitmapByName("bg_png");t.width=586,t.height=745,t.x=65,t.y=45,this.addChild(t),this._top=this.createBitmapByName("top_png"),this._top.name="top",this._top.width=119,this._top.height=46,this._top.x=90,this._top.y=45,this.addChild(this._top),this._line=this.createBitmapByName("line_png"),this._line.name="line",this._line.width=15,this._line.height=71,this._line.x=142,this._line.y=90,this.addChild(this._line),this._zhua=this.createBitmapByName("zhua1_png"),this._zhua.name="zhua",this._zhua.width=183,this._zhua.height=155,this._zhua.x=59,this._zhua.y=161,this.addChild(this._zhua),this._zhuaMask=new egret.Shape,this._zhuaMask.name="zhuaMask",this._zhuaMask.graphics.beginFill(3355443),this._zhuaMask.graphics.drawEllipse(0,0,140,70),this._zhuaMask.graphics.endFill(),this._zhuaMask.x=59,this._zhuaMask.y=730,this._zhuaMask.$setVisible(!1),this.addChild(this._zhuaMask),this._zhuaShade=new egret.Shape,this._zhuaShade.name="zhuaShade",this._zhuaShade.graphics.beginFill(65280),this._zhuaShade.graphics.drawEllipse(0,0,140,70),this._zhuaShade.graphics.endFill(),this._zhuaShade.x=59,this._zhuaShade.y=730,this._zhuaShade.$setVisible(!1),this.addChild(this._zhuaShade);var e=this.createBitmapByName("doll_bg_png"),i=this.stage.stageWidth,s=this.stage.stageHeight;e.width=i,e.height=s,e.name="dollbg",this.addChild(e),this._up=this.createBitmapByName("up_png"),this._up.name="up",this._up.width=119,this._up.height=109,this._up.x=120,this._up.y=750,this._up.$setVisible(!1),this.addChild(this._up),this._left=this.createBitmapByName("left_png"),this._left.name="left",this._left.width=179,this._left.height=119,this._left.y=840,this._left.$setVisible(!1),this.addChild(this._left),this._right=this.createBitmapByName("right_png"),this._right.name="right",this._right.width=179,this._right.height=119,this._right.x=179,this._right.y=840,this._right.$setVisible(!1),this.addChild(this._right),this._down=this.createBitmapByName("down_png"),this._down.name="down",this._down.width=119,this._down.height=109,this._down.x=120,this._down.y=939,this._down.$setVisible(!1),this.addChild(this._down),this._btn=this.createBitmapByName("btn_zhua1_png"),this._btn.width=241,this._btn.height=159,this._btn.x=370,this._btn.y=815,this._btn.$setVisible(!1),this.addChild(this._btn),this._start=this.createBitmapByName("btn_start_png"),this._start.width=367,this._start.height=119,this._start.x=140,this._start.y=835,this.addChild(this._start),this._dot=new egret.Shape,this._dot.graphics.beginFill(65280),this._dot.graphics.drawCircle(0,0,5),this._dot.graphics.endFill()},e.prototype.launchCollisionTest=function(){},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");