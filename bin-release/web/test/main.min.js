var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Actions;!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.UP=2]="UP",t[t.DOWN=3]="DOWN"}(Actions||(Actions={}));var Main=function(t){function e(){var e=t.call(this)||this;return e._position=0,e._positionY=0,e._step=10,e._isRunning=!1,e._isStarting=!1,e._isCountdown=!1,e._probability=.5,e._catchIndex=-1,e._moveHight=-1,e._wawaids={"5a3e103e85d7c00602406446":"wawa0","5a3e107485d7c00602406447":"wawa2","5a445b447e6b1e01155ceb08":"wawa1","5a445b7c7e6b1e01155ceb09":"wawa3","5a445b857e6b1e01155ceb0a":"wawa4","5a445b8d7e6b1e01155ceb0b":"wawa5","5a4c86e2c5f56040a6b5f5c5":"wawa10","5a4c8756c5f56040a6b5f5c6":"wawa13","5a4c8775c5f56040a6b5f5c7":"wawa8","5a4c8785c5f56040a6b5f5c8":"wawa11","5a4c8795c5f56040a6b5f5c9":"wawa7","5a4c87aac5f56040a6b5f5ca":"wawa6","5a4c87bdc5f56040a6b5f5cb":"wawa14","5a4c87d3c5f56040a6b5f5cc":"wawa9","5a4c87ebc5f56040a6b5f5cd":"wawa12"},e._wawaName="wawa",e._param={},e._gametime=20,e._time=20,e._key="",e._toys=[],e._masks=[],e.getWawaName(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.getWawaName=function(){var t=window.location.search.replace("?","");if(""!==t){for(var e={},i=0,s=t.split("&");i<s.length;i++){var n=s[i],h=n.split("=");e[h[0]]=h[1]}this._param=e,this._wawaName=this._wawaids[e.wawaid]||"wawa"}},e.prototype.startGame=function(){var t=this;try{var e=this;window.parent.startGame(this._param.wawaid,function(i){e._isStarting=!0,e.toggleShow(!0),e._isCountdown=!0,e.countdown(t._gametime),e._key=i})}catch(i){console.log("开始玩游戏失败")}},e.prototype.continueGame=function(t){this._isStarting=!1,this.toggleShow(!1),this.setGameTime(this._gametime);try{window.parent["continue"](t)}catch(e){console.log("继续玩游戏失败")}},e.prototype.catchToy=function(){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.open("api/game/catch",egret.HttpMethod.POST),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.setRequestHeader("X-Auth-Token",this._param.token),t.send("prizeId="+this._param.wawaid+"&token="+this._key),t.addEventListener(egret.Event.COMPLETE,this.onCatchCallback,this)},e.prototype.onCatchCallback=function(t){var e=this,i=t.currentTarget,s=!1;if(""!=i.response)try{s=null!=JSON.parse(i.response).content}catch(n){console.log("抓娃娃时，回调解析出错")}var h=this._toys[this._catchIndex],a=this._moveHight;if(s){var o=this._masks[this._catchIndex];this.removeChild(o),this._masks.splice(this._catchIndex,1),egret.Tween.get(h).to({x:h.x-this._position},300,egret.Ease.sineIn).wait(100).to({y:h.y+a-this._positionY},300,egret.Ease.sineIn).call(function(){e.removeChild(h),e._toys.splice(e._catchIndex,1),0===e._toys.length&&setTimeout(function(){e.initToy()},0),e.continueGame(s)})}else{var r=function(){h.rotation=30*Math.random()-15},_=function(){h.rotation=0};egret.Tween.get(h,{onChange:r,onChangeObj:this}).to({y:h.y+a-50},300,egret.Ease.sineIn).call(function(){egret.Tween.get(h,{onChange:_,onChangeObj:e}).to({y:h.y+50},100,egret.Ease.sineIn).call(function(){e.continueGame(s)})})}this._catchIndex=-1},e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.checkCollision=function(t,e){this._dot.x=t,this._dot.y=e},e.prototype.directionClick=function(t,e){if(this._isStarting){if(this._up.hitTestPoint(t,e,!0))return void this.move(Actions.UP);if(this._down.hitTestPoint(t,e,!0))return void this.move(Actions.DOWN);if(this._left.hitTestPoint(t,e,!0))return void this.move(Actions.LEFT);if(this._right.hitTestPoint(t,e,!0))return void this.move(Actions.RIGHT);if(this._btn.hitTestPoint(t,e,!0)){if(this._isRunning)return;return this._isRunning=!0,this._isCountdown=!1,void this.toZhua()}}else this._start.hitTestPoint(t,e,!0)&&this.startGame()},e.prototype.toZhua=function(){var t=this,e=this._zhuaMask.y-this._zhua.y-this._zhua.height-50;this._moveHight=e,egret.Tween.get(this._line).to({height:this._line.height+e},500,egret.Ease.sineIn).wait(100).to({height:this._line.height},500,egret.Ease.sineOut).wait(100),egret.Tween.get(this._zhua).to({y:this._zhua.y+e},500,egret.Ease.sineIn).wait(100).call(function(){t._zhua.texture=RES.getRes("zhua2_png");var i=t._zhua.x+t._zhua.width/2,s=t._zhua.y+t._zhua.height,n=function(n){var h=t._toys[n];return h.hitTestPoint(i,s,!0)?(egret.Tween.get(h).to({y:h.y-e},500,egret.Ease.sineOut).wait(100).call(function(){t._catchIndex=parseInt(n),t.catchToy()}),{value:void 0}):void 0};for(var h in t._toys){var a=n(h);if("object"==typeof a)return a.value}t.continueGame(!1)}).to({y:this._zhua.y},500,egret.Ease.sineOut).wait(100).call(function(){t._isRunning=!1,t.back()})},e.prototype.toggleShow=function(t){this._up.$setVisible(t),this._down.$setVisible(t),this._left.$setVisible(t),this._right.$setVisible(t),this._btn.$setVisible(t),this._start.$setVisible(!t)},e.prototype.move=function(t){var e=this;if(t===Actions.RIGHT||t===Actions.LEFT){if(t===Actions.LEFT&&this._position<1||t===Actions.RIGHT&&this._position>510)return;var i=t===Actions.RIGHT?this._step:-1*this._step;this._position+=i,egret.Tween.get(this._top).to({x:this._top.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._line).to({x:this._line.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhuaMask).to({x:this._zhuaMask.x+i},100,egret.Ease.sineIn),egret.Tween.get(this._zhua).to({x:this._zhua.x+i},100,egret.Ease.sineIn).call(function(){e.moveEnd(t)})}else{if(t===Actions.DOWN&&this._positionY>=0||t===Actions.UP&&this._positionY<=-220)return;var i=t===Actions.UP?-1*this._step:this._step;this._positionY+=i,egret.Tween.get(this._zhuaMask).to({y:this._zhuaMask.y+i},100,egret.Ease.sineIn).call(function(){e.moveEnd(t)})}},e.prototype.moveEnd=function(t){var e=this;this._dot.parent&&setTimeout(function(){e.move(t)},30);for(var i=0,s=this._masks;i<s.length;i++){var n=s[i],h=n.x+n.width/2,a=n.y+n.height/2;if(this._zhuaMask.hitTestPoint(h,a,!0)){if(this.getChildIndex(this._zhua)-this.getChildIndex(n)!==1){var o=this.getChildIndex(n);this.setChildIndex(this._zhua,o),this.setChildIndex(this._line,o)}return}}},e.prototype.back=function(){var t=this;egret.Tween.get(this._top).to({x:this._top.x-this._position},300,egret.Ease.sineIn),egret.Tween.get(this._line).to({x:this._line.x-this._position},300,egret.Ease.sineIn),egret.Tween.get(this._zhuaMask).to({x:this._zhuaMask.x-this._position,y:this._zhuaMask.y-this._positionY},300,egret.Ease.sineIn),egret.Tween.get(this._zhua).to({x:this._zhua.x-this._position},300,egret.Ease.sineIn).call(function(){t._position=0,t._positionY=0,t._zhua.texture=RES.getRes("zhua1_png")})},e.prototype.initToy=function(){for(var t=0;3>t;t++)for(var e=0===t?2:3,i=0===t?0:60*(2-t),s=0;e>s;s++){var n=this.createBitmapByName(this._wawaName+"_png");n.width=169,n.height=176,n.x=500-180*s-i,n.y=650-100*t,n.name="toy_"+(s+1)+"_"+(t+1),this.addChild(n),this.setChildIndex(n,5),this._toys.push(n);var h=new egret.Shape;h.graphics.lineStyle(0),h.graphics.beginFill(3625326,.2),h.graphics.drawEllipse(0,0,100,40),h.graphics.endFill(),h.x=530-180*s-i,h.y=800-100*t,h.name="mask_"+(s+1)+"_"+(t+1),this.addChild(h),this.setChildIndex(h,5),this._masks.push(h)}this._zhuaMask.$setVisible(!0)},e.prototype.touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_MOVE:this.checkCollision(t.stageX,t.stageY);break;case egret.TouchEvent.TOUCH_BEGIN:this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.stage.once(egret.TouchEvent.TOUCH_END,this.touchHandler,this),this.addChild(this._dot),this.checkCollision(t.stageX,t.stageY),this.directionClick(t.stageX,t.stageY);break;case egret.TouchEvent.TOUCH_END:this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandler,this),this._dot.parent&&this._dot.parent.removeChild(this._dot)}},e.prototype.createGameScene=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandler,this);var t=this.createBitmapByName("bg_png");t.width=646,t.height=728,t.x=52,t.y=130,t.name="bg",this.addChild(t),this._top=this.createBitmapByName("top_png"),this._top.name="top",this._top.width=28,this._top.height=18,this._top.x=102,this._top.y=130,this.addChild(this._top),this._line=this.createBitmapByName("line_png"),this._line.name="line",this._line.width=12,this._line.height=50,this._line.x=110,this._line.y=146,this.addChild(this._line),this._zhua=this.createBitmapByName("zhua1_png"),this._zhua.name="zhua",this._zhua.width=174,this._zhua.height=190,this._zhua.x=29,this._zhua.y=191,this.addChild(this._zhua),this._zhuaMask=new egret.Shape,this._zhuaMask.name="zhuaMask",this._zhuaMask.graphics.beginFill(3625326,.3),this._zhuaMask.graphics.drawEllipse(0,0,140,70),this._zhuaMask.graphics.endFill(),this._zhuaMask.x=59,this._zhuaMask.y=800,this._zhuaMask.$setVisible(!1),this.addChild(this._zhuaMask);var e=this.createBitmapByName("exit_png");e.width=210,e.height=204,e.x=52,e.y=654,e.name="exit",this.addChild(e);var i=this.createBitmapByName("doll_bg_png");this.stage.stageWidth,this.stage.stageHeight;i.width=708,i.height=906,i.x=21,i.name="dollbg",this.addChild(i),this._up=this.createBitmapByName("up_png"),this._up.name="up",this._up.width=90,this._up.height=94,this._up.x=160,this._up.y=920,this._up.$setVisible(!1),this.addChild(this._up),this._left=this.createBitmapByName("left_png"),this._left.name="left",this._left.width=90,this._left.height=94,this._left.x=40,this._left.y=980,this._left.$setVisible(!1),this.addChild(this._left),this._right=this.createBitmapByName("right_png"),this._right.name="right",this._right.width=90,this._right.height=94,this._right.x=280,this._right.y=980,this._right.$setVisible(!1),this.addChild(this._right),this._down=this.createBitmapByName("down_png"),this._down.name="down",this._down.width=90,this._down.height=94,this._down.x=160,this._down.y=1040,this._down.$setVisible(!1),this.addChild(this._down),this._btn=this.createBitmapByName("btn_zhua_png"),this._btn.name="btn_zhua",this._btn.width=188,this._btn.height=176,this._btn.x=500,this._btn.y=910,this._btn.$setVisible(!1),this.addChild(this._btn),this._start=this.createBitmapByName("btn_start_png"),this._btn.name="btn_start",this._start.width=342,this._start.height=114,this._start.x=204,this._start.y=980,this.addChild(this._start),this._dot=new egret.Shape,this._dot.graphics.beginFill(65280),this._dot.graphics.drawCircle(0,0,5),this._dot.graphics.endFill(),this.initToy()},e.prototype.setGameTime=function(t){try{window.parent.setGameTime(t)}catch(e){console.log("倒计时失败")}},e.prototype.countdown=function(t){var e=this;this.setGameTime(t),setTimeout(function(){t>0?e._isCountdown&&e.countdown(t-1):(e._isCountdown=!1,e.toZhua())},1e3)},e.prototype.launchCollisionTest=function(){},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");